## üïµÔ∏è‚Äç‚ôÇÔ∏è Cheatsheet: Linux Kernel Privilege Escalation

A Linux kernel exploit targets a vulnerability in the core of the operating system to gain elevated privileges, almost always **root**. It's one of the most powerful privilege escalation methods because a successful exploit gives you complete control over the system. üí•

### ## What to Look For (Reconnaissance)

Your first step is to gather precise information about the target system. The exploit you choose **must match** the kernel version and architecture.

* **Get Kernel & OS Version:** This is the most critical piece of information.
    ```bash
    uname -a
    # Output might be: Linux target-box 4.4.0-31-generic #50-Ubuntu SMP Wed Jul 13 00:07:12 UTC 2016 x86_64 x86_64 x86_64 GNU/Linux
    ```
    Key info here: `4.4.0-31-generic` and `Ubuntu`.

* **Get Distribution Information:**
    ```bash
    cat /etc/os-release
    # Or
    lsb_release -a
    ```

* **Check Architecture:** Is it 32-bit or 64-bit?
    ```bash
    uname -m
    # x86_64 means 64-bit. i686 or i386 means 32-bit.
    ```
* **Check for Compilers:** Many kernel exploits are written in C and need to be compiled on the target machine.
    ```bash
    which gcc
    # Or
    gcc --version
    ```
    If `gcc` is present, your job is much easier.

---

### ## Finding & Using Exploits

Once you have the version info, you can hunt for a public exploit.

#### **Common Tools**

* **SearchSploit:** A command-line tool for Exploit-DB. It's the go-to for finding exploits offline.
    ```bash
    # Search for exploits matching the kernel version
    searchsploit linux kernel 4.4
    ```
* **Automated Scripts:** These scripts automate the entire recon and search process. They are extremely effective.
    * **LinPEAS (`linpeas.sh`):** A comprehensive script that checks for kernel exploits among hundreds of other misconfigurations.
    * **Linux Exploit Suggester (`les.sh`):** A script specifically focused on suggesting relevant kernel exploits based on the `uname` output.
* **File Transfer & Compilation:**
    * `wget` / `curl`: To download the exploit code to the target.
    * `python -m http.server`: To host the exploit file on your attack machine.
    * `gcc`: To compile the exploit source code (`.c` file) on the target machine.
    * `nc` (netcat): Often used to receive a reverse shell after the exploit succeeds.

#### **Simplified Exploitation Workflow**

1.  **Identify:** Run `uname -a` on the target to get the kernel version (e.g., `4.4.0`).
2.  **Find:** On your machine, use `searchsploit linux kernel 4.4` to find a relevant exploit (e.g., a famous one like "Dirty COW").
3.  **Transfer:** Host the exploit's `.c` file on your machine and download it to the target's `/tmp` directory using `wget`.
4.  **Compile:** On the target, compile the code: `gcc exploit.c -o exploit -pthread`. (Flags like `-pthread` may vary).
5.  **Execute:** Run the compiled binary: `./exploit`.
6.  **Verify:** If it works, you'll often be dropped into a root shell. Confirm with `whoami` or `id`. The output should be **root**.



---

### ## üõ°Ô∏è Detection & Remediation (For Defenders)

#### **How to Detect an Attempt**

* **Log Analysis:** A failed exploit attempt can cause a **kernel panic**. Check logs in `/var/log/syslog` or use `dmesg` for kernel ring buffer messages indicating errors or crashes.
* **System Monitoring:** Look for unexpected processes being spawned by low-privilege users, especially processes that suddenly run as `root`.
* **Crash Dumps:** Check for kernel crash dumps in `/var/crash/`. Their presence indicates a major system failure, possibly from a bad exploit.

#### **How to Prevent Kernel Exploits**

* **PATCH YOUR SYSTEMS!** This is the single most important defense. A patched kernel is immune to old, public exploits. Use your system's package manager regularly.
    ```bash
    # For Debian/Ubuntu
    sudo apt update && sudo apt dist-upgrade

    # For CentOS/RHEL
    sudo yum update
    ```
* **Reboot After Patching:** Kernel updates are only applied after a **reboot**. Schedule regular reboots after patch cycles.
* **Minimize Attack Surface:** Do not install development tools like `gcc` on production servers unless absolutely necessary. This forces an attacker to use more complex methods than simply compiling on the box.
* **Use Hardened Kernels:** For high-security environments, consider using kernels with hardening patches like `grsecurity` or enabling all available security features in the standard kernel.
* **Use Containers:** While not a perfect solution, running applications inside containers (e.g., Docker) can make it harder for an attacker to leverage a kernel exploit against the host, as it requires an additional "container escape" vulnerability.
